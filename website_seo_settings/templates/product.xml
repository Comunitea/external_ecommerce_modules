<?xml version="1.0" encoding="UTF-8" ?>
<odoo>

    <!-- The product template changes -->
    <template id="website_sale_product" name="Product Seo" inherit_id="website_sale.product">

        <!-- Product descriptions -->
        <xpath expr="//div[@id='product_details']//div[hasclass('o_not_editable')]" position="after">
            <div id="website_description_short" t-if="product.website_description_short">
                <hr t-if="product.website_description_short" />
                <p itemprop="slogan" t-field="product.website_description_short"/>
            </div>
        </xpath>
        <xpath expr="//div[@id='product_details']/hr[last()]" position="attributes">
            <attribute name="t-if">product.website_description_short or product.description_sale or product.tag_ids</attribute>
        </xpath>
        <xpath expr="//div[@id='product_full_description']" position="replace">
            <div class="oe_structure mt32 mb32" id="product_full_description" t-if="product.website_description and len(product.website_description) > 15">
                <div class="container" itemprop="description">
                    <div class="row">
                        <div class="col-md-12">
                            <ul class="nav nav-pills" id="product-nav-tab" role="tablist">
                                <li class="nav-item" t-if="product.website_description and len(product.website_description) > 15">
                                    <a class="nav-link active" id="description-tab" href="#description-content"
                                       data-toggle="pill" role="tab" aria-controls="description" aria-selected="true"><h2>Description</h2></a>
                                </li>
                                <li class="nav-item" t-if="product.website_specifications and len(product.website_specifications) > 15">
                                    <a class="nav-link" id="specifications-tab" href="#specifications-content"
                                       data-toggle="pill" role="tab" aria-controls="specifications" aria-selected="false"><h2>Specifications</h2></a>
                                </li>
                            </ul>
                        </div>
                        <div class="col-md-12">
                            <div class="tab-content mt16" id="product-nav-tabContent">
                                <div class="tab-pane active" id="description-content" role="tabpanel" aria-labelledby="description-tab"
                                     t-if="product.website_description and len(product.website_description) > 15">
                                    <div class="col-md-12 mt16" t-field="product.website_description"/>
                                </div>
                                 <div class="tab-pane" id="specifications-content" role="tabpanel" aria-labelledby="specifications-tab"
                                      t-if="product.website_specifications and len(product.website_specifications) > 15">
                                    <div class="col-md-12 mt16" t-field="product.website_specifications"/>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </xpath>

        <!-- ECommerce category link in breadcrumbs without breadcrumbs_base_tmp module installed -->
<!--        <xpath expr="//ol[hasclass('breadcrumb')]/li[@t-if='category']" position="replace">-->
<!--            <li t-if="product.public_categ_ids">-->
<!--                <t t-set="inc" t-value="0"/>-->
<!--                <t t-foreach="product.public_categ_ids" t-as="cat">-->
<!--                    <t t-if="inc==0">-->
<!--                        <a t-att-href="'/category/%s' % cat.slug if cat.slug else '/shop/category/%s' % slug(cat)" t-field="cat.name" />-->
<!--                    </t>-->
<!--                    <t t-set="inc" t-value="inc+1"/>-->
<!--                </t>-->
<!--            </li>-->
<!--        </xpath>-->

        <!-- Hide guarantee -->
        <xpath expr="//div[@id='product_details']/p[last()]" position="attributes">
            <attribute name="class" add="d-none" separator=" "/>
        </xpath>
    </template>

    <!-- Change Product description Sale for customers -->
    <template id="website_sale_products_description" inherit_id="website_sale.products_description" name="Product Description Seo">
        <xpath expr="//div[hasclass('oe_subdescription')]" position="replace">
            <div class="text-info oe_subdescription" contenteditable="false">
                <h6 itemprop="description" t-field="product.description_sale"/>
            </div>
        </xpath>
    </template>

    <!-- Product item used by /shop and /shop/cart -->
    <template id="website_sale_products_item" name="Product Item Seo" inherit_id="website_sale.products_item">
        <!-- Set Ribbons -->
        <xpath expr="//div[hasclass('ribbon-wrapper')]/a" position="replace">
            <t t-set="has_responsive_view" t-value="request.website.viewref('website_seo_settings.website_sale_products_responsive').active"/>
            <t t-set="has_responsive_full_view" t-value="request.website.viewref('website_seo_settings.website_sale_products_responsive_full').active"/>
            <t t-if="has_responsive_view or has_responsive_full_view">
                <a href="#" role="button" t-attf-class="ribbon btn ribbon-color-#{product.website_style_ids and product.website_style_ids[0].color}"
                   t-field="product.website_style_ids and product.website_style_ids[0].name"/>
            </t>
            <t t-else="">
                <a href="#" role="button" t-attf-class="ribbon btn ribbon-color-#{td_product['product'].website_style_ids and td_product['product'].website_style_ids[0].color}"
                   t-field="td_product['product'].website_style_ids and td_product['product'].website_style_ids[0].name"/>
            </t>
        </xpath>
        <!-- Set Friendly URL -->
        <xpath expr="//t[@t-set='product_href']" position="attributes">
            <attribute name="t-value">'/product/{}'.format(product.slug) if product.slug else keep('/shop/product/%s' % slug(product))</attribute>
        </xpath>
        <!-- Set product name -->
        <xpath expr="//section/h6" position="replace">
            <div class="text-info oe_product_name" contenteditable="false">
                <h6>
                    <a itemprop="name" t-att-href="product_href" t-att-content="product.name"><span t-esc="product.name.lower().capitalize()"/></a>
                    <a role="button" t-if="not show_publish and not product.website_published" t-att-href="product_href" class="btn btn-secondary btn-sm btn-danger" title="This product is unpublished.">Unpublished</a>
                </h6>
            </div>
        </xpath>
        <!-- Set product image -->
        <xpath expr="//div[hasclass('oe_product_image')]/a/span" position="replace">
            <span t-field="product.image" t-options="{'widget': 'image'}"/>
        </xpath>
    </template>

    <!-- Include default code inside product item -->
    <template id="products_default_code" inherit_id="website_sale.products_item" active="False" customize_show="True" name="Product SKU">
        <xpath expr="//div[hasclass('oe_product_name')]" position="before">
            <div class="text-info oe_sku text-truncate" contenteditable="false">
                <h6 itemprop="sku" t-field="product.default_code"/>
            </div>
        </xpath>
    </template>

    <!-- Product item add to cart button used by /shop -->
    <template id="website_sale_products_add_to_cart" name="Add to Cart Seo" inherit_id="website_sale.products_add_to_cart">
        <xpath expr="//t[2]/a" position="attributes">
            <attribute name="t-att-href">keep('/product/{}', page=(pager['page']['num'] if pager['page']['num']&gt;1 else None)).format(product.slug) if product.slug else keep('/shop/product/%s' % slug(product), page=(pager['page']['num'] if pager['page']['num']&gt;1 else None))</attribute>
        </xpath>
    </template>

     <template id="website_sale_shop_product_carousel" name="Shop Product Carousel Seo" inherit_id="website_sale.shop_product_carousel">
         <!-- Image URL, attributes and ribbons -->
         <xpath expr="//div[hasclass('carousel-inner')]" position="replace">
             <div class="carousel-inner">
                 <t t-set="ribbon_class" t-value="product.website_style_ids and product.website_style_ids[0].filtered(lambda x: 'oe_ribbon' in x.html_class).html_class or ''"/>
                 <div t-if="variant_img" class="carousel-item active oe_product #{ ribbon_class }">
                     <div t-attf-class="ribbon-wrapper">
                         <a href="#" role="button" t-attf-class="ribbon btn ribbon-color-#{product.website_style_ids and product.website_style_ids[0].color}"
                            t-field="product.website_style_ids and product.website_style_ids[0].name"/>
                     </div>
                     <img t-att-alt="product_variant.name" t-att-title="product.name" class="img img-fluid product_detail_img js_variant_img"
                          t-attf-src="/website/image/product.template/{{product.id}}/image"
                          data-zoom="1" t-attf-data-zoom-image="/website/image/product.template/{{product.id}}/image"
                          itemprop="image"/>
                 </div>
                 <div t-attf-class="carousel-item#{'' if variant_img else ' active'} oe_product #{ ribbon_class }">
                     <div t-attf-class="ribbon-wrapper">
                         <a href="#" role="button" t-attf-class="ribbon btn ribbon-color-#{product.website_style_ids and product.website_style_ids[0].color}"
                            t-field="product.website_style_ids and product.website_style_ids[0].name"/>
                     </div>
                     <img t-att-alt="product.name" t-att-title="product.name" class="img img-fluid product_detail_img"
                          t-attf-src="/website/image/product.template/{{product.id}}/image"
                          data-zoom="1" t-attf-data-zoom-image="/website/image/product.template/{{product.id}}/image/"
                          itemprop="image"/>
                 </div>
                 <t t-if="len(image_ids)" t-foreach="image_ids" t-as="pimg">
                     <div t-attf-class="carousel-item oe_product #{ ribbon_class }">
                         <div t-attf-class="ribbon-wrapper">
                             <a href="#" role="button" t-attf-class="ribbon btn ribbon-color-#{product.website_style_ids and product.website_style_ids[0].color}"
                                t-field="product.website_style_ids and product.website_style_ids[0].name"/>
                         </div>
                         <img t-att-alt="pimg.name" t-att-title="pimg.name" class="img img-fluid product_detail_img"
                              t-attf-src="/web/image/product.image/{{pimg.id}}/image/"
                              data-zoom="1" t-attf-data-zoom-image="/website/image/product.template/{{product.id}}/image/"
                              itemprop="image"/>
                     </div>
                 </t>
             </div>
         </xpath>
        <xpath expr="//ol[hasclass('carousel-indicators')]" position="replace">
            <ol t-if="len(image_ids) or variant_img" class="carousel-indicators">
                <li t-if="variant_img" data-target="#o-carousel-product" data-slide-to="0" class="active">
                    <img class="img img-fluid js_variant_img_small" t-attf-src="/website/image/product.product/{{product_variant.id}}/image/90x90"
                         t-att-alt="product.name" t-att-title="product.name"/>
                </li>
                <li data-target="#o-carousel-product" t-att-data-slide-to="1 if variant_img else '0'" t-att-class="'' if variant_img else 'active'">
                    <img class="img img-fluid" t-attf-src="/website/image/product.template/{{product.id}}/image/90x90" t-att-alt="product.name" t-att-title="product.name"/>
                </li>
                <t t-if="len(image_ids)" t-foreach="image_ids" t-as="pimg">
                    <li data-target="#o-carousel-product" t-att-data-slide-to="pimg_index + (variant_img and 2 or 1)">
                        <img class="img img-fluid" t-attf-src="/website/image/product.image/{{pimg.id}}/image/90x90" t-att-alt="pimg.name" t-att-title="pimg.name"/>
                    </li>
                </t>
            </ol>
        </xpath>
     </template>

     <template id="website_tag_template" name="Website tag template">
         <t t-set="is_current" t-value="'current' if current_tag == tag else ''"/>
         <a itemprop="additionalProperty" rel="noindex,nofollow" t-att-href="'/tag/%s' % tag.slug"  t-att-class="'btn btn-primary mb8 tag-%s %s' % (tag.color, is_current)">
             <span t-field="tag.name"/>
         </a>
    </template>

    <template id="website_sale_search_for_tags" name="Search Box Tags">
        <form t-att-action="keep('/tag/' + current_tag.slug, search=0)" method="get" t-att-class="_classes">
            <t t-if="attrib_values">
                <t t-foreach="attrib_values" t-as="a">
                    <input type="hidden" name="attrib" t-att-value="'%s-%s' % (a[0], a[1])" />
                </t>
            </t>
            <t t-call="website.website_search_box" />
        </form>
    </template>

    <!-- Include Product Tags inside product detail -->
     <template id="product_tags" inherit_id="website_sale.product" name="Product Tags" active="False" customize_show="True">
        <xpath expr="//div[@id='product_details']" position="inside">
            <t t-set="product_tags" t-value="product.tag_ids.filtered(lambda x: x.website_published == True and x.website_id == request.website)"/>
            <t t-if="product_tags">
                <div class="oe_structure">
                    <t t-foreach="product_tags" t-as="tag">
                        <t t-call="website_seo_settings.website_tag_template">
                            <t t-set="tag" t-value="tag"/>
                        </t>
                    </t>
                    <hr/>
                </div>
            </t>
        </xpath>
    </template>

    <!-- Add Price Name before price qty -->
    <template id="website_sale_product_price" inherit_id="website_sale.product_price" active="True" customize_show="True" name="Price Name">
        <xpath expr="//h4[hasclass('oe_price_h4')]/span" position="before">
            <span><strong contenteditable="false">Price: </strong></span>
        </xpath>
        <xpath expr="//h4[hasclass('decimal_precision')]/span" position="before">
            <span><strong contenteditable="false">Price: </strong></span>
        </xpath>
    </template>

    <!-- Include default code (SKU) inside product detail. Before categories -->
    <template id="product_default_code" inherit_id="website_sale.product" active="True" customize_show="True" name="Product SKU" priority="105">
        <xpath expr="//div[@id='product_details']//t[@t-call='website_sale.product_price']" position="after">
            <h4 itemprop="sku" class="oe_price_h4 mt-3"><span><strong contenteditable="false">Sku: </strong></span><span t-field="product.default_code"/></h4>
        </xpath>
    </template>

    <!-- Include Product Tags inside product detail as List. After SKU -->
    <template id="product_tags_list" inherit_id="website_sale.product" name="Product Tags List" active="True" customize_show="True" priority="104">
        <xpath expr="//div[@id='product_details']//t[@t-call='website_sale.product_price']" position="after">
            <t t-set="product_tags" t-value="product.tag_ids.filtered(lambda x: x.website_published == True and x.website_id == request.website)"/>
            <t t-if="product_tags">
                <h4 class="oe_price_h4 mt-3">
                    <strong>Tags: </strong>
                    <t t-foreach="product_tags" t-as="tag">
                        <a itemprop="additionalProperty" rel="noindex,nofollow" t-att-href="'/tag/%s' % tag.slug"
                           t-att-class="'tag-%s %s' % (tag.color, is_current)" style="font-size: 0.875rem;">
                            <span t-field="tag.name"/><span t-if="tag_index + 1 &lt; len(product_tags)">, </span>
                        </a>
                    </t>
                    <span>.</span>
                </h4>
            </t>
        </xpath>
    </template>

    <!-- Include eCommerce categories inside product detail as List. After SKU -->
    <template id="product_categories_list" inherit_id="website_sale.product" name="Product Categories List" active="True" customize_show="True" priority="103">
        <xpath expr="//div[@id='product_details']//t[@t-call='website_sale.product_price']" position="after">
            <t t-set="product_categories" t-value="product.public_categ_ids.filtered(lambda x: x.website_published == True and x.website_id == request.website)"/>
            <t t-if="product_categories">
                <h4 class="oe_price_h4 mt-3">
                    <strong>Categories: </strong>
                    <t t-foreach="product_categories" t-as="categ">
                        <a itemprop="category" rel="noindex,nofollow" t-att-class="'categ-%s' % categ.color" style="font-size: 0.875rem;"
                           t-att-href="'/category/%s' % categ.slug if categ.slug else keep('/shop/category/' + slug(categ), category=0)">
                            <span t-field="categ.name"/><span t-if="categ_index + 1 &lt; len(product_categories)">, </span>
                        </a>
                    </t>
                    <span>.</span>
                </h4>
            </t>
        </xpath>
    </template>

    <!-- Include eCommerce categories inside product detail as List. After SKU -->
    <template id="product_ribbon_promotions_list" inherit_id="website_sale.product" name="Product Promotions List" active="True" customize_show="True" priority="102">
        <xpath expr="//div[@id='product_details']//t[@t-call='website_sale.product_price']" position="after">
            <t t-set="product_ribbon_promotions" t-value="product.website_style_ids"/>
            <t t-if="product_ribbon_promotions">
                <h4 class="oe_price_h4 mt-3">
                    <strong>Promotions: </strong>
                    <t t-foreach="product_ribbon_promotions" t-as="promo">
                        <span itemprop="additionalProperty" t-att-class="'promo-%s' % promo.color" style="font-size: 0.875rem;" t-field="promo.name"/><span t-if="promo_index + 1 &lt; len(product_ribbon_promotions)">, </span>
                    </t>
                    <span>.</span>
                </h4>
            </t>
        </xpath>
    </template>

    <!-- Include eCommerce categories inside product detail as Tags -->
    <template id="product_categories_tags" inherit_id="website_sale.product" name="Product Categories Tags" active="False" customize_show="True">
        <xpath expr="//div[@id='product_details']" position="inside">
            <t t-set="product_categories" t-value="product.public_categ_ids.filtered(lambda x: x.website_published == True and x.website_id == request.website)"/>
            <t t-if="product_categories">
                <div class="oe_structure">
                    <t t-foreach="product_categories" t-as="categ">
                        <a itemprop="category" rel="noindex,nofollow" t-att-class="'btn btn-primary mb8 categ-%s' % categ.color"
                           t-att-href="'/category/%s' % categ.slug if categ.slug else keep('/shop/category/' + slug(categ), category=0)">
                            <span t-field="categ.name"/>
                        </a>
                    </t>
                    <hr/>
                </div>
            </t>
        </xpath>
    </template>

    <template id="product_categories_tags_collapsible" inherit_id="website_sale.product" name="Product Categories and Tags Collapsible" active="True" customize_show="True">
        <xpath expr="//div[@id='product_details']" position="inside">
            <t t-set="product_tags" t-value="product.tag_ids.filtered(lambda x: x.website_published == True and x.website_id == request.website)"/>
            <t t-set="product_categories" t-value="product.public_categ_ids.filtered(lambda x: x.website_published == True and x.website_id == request.website)"/>
            <h4 class="text-center" t-if="product_tags or product_categories">
                <a class="btn btn-link" style="font-size: 1.3rem;" role="button" data-toggle="collapse" href="#multiCollapseTags" data-target="#multiCollapseTags" aria-expanded="false"
                    aria-controls="multiCollapseTags" t-if="product_tags">Tags</a>
                <a class="btn btn-link" style="font-size: 1.3rem;" role="button" data-toggle="collapse" href="#multiCollapseCategories" data-target="#multiCollapseCategories" aria-expanded="false"
                    aria-controls="multiCollapseCategories" t-if="product_categories">Categories</a>
                <a class="btn btn-link" style="font-size: 1.3rem;" role="button" data-toggle="collapse" href=".multi-collapse" data-target=".multi-collapse" aria-expanded="false"
                    aria-controls="multiCollapseTags multiCollapseCategories" t-if="product_tags and product_categories">All</a>
            </h4>
            <div class="row text-center " t-if="product_tags or product_categories">
                <div class="col mt-2">
                    <div class="collapse multi-collapse" id="multiCollapseTags" t-if="product_tags">
                        <div class="card card-body">
                            <t t-foreach="product_tags" t-as="tag">
                                <t t-call="website_seo_settings.website_tag_template">
                                    <t t-set="tag" t-value="tag"/>
                                </t>
                            </t>
                        </div>
                    </div>
                    <div class="collapse multi-collapse" id="multiCollapseCategories" t-if="product_categories">
                        <div class="card card-body">
                            <t t-foreach="product_categories" t-as="categ">
                                <a itemprop="category" rel="noindex,nofollow" t-att-class="'btn btn-primary mb8 categ-%s' % categ.color"
                                   t-att-href="'/category/%s' % categ.slug if categ.slug else keep('/shop/category/' + slug(categ), category=0)">
                                    <span t-field="categ.name"/>
                                </a>
                            </t>
                        </div>
                    </div>
                </div>
            </div>
            <hr t-if="product_tags or product_categories"/>
        </xpath>
    </template>

</odoo>
